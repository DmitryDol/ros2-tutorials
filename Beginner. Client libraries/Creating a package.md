# Создание пакета

## Справочная информация

### 1. Что такое пакет ROS 2?

Пакет - это организационная единица для вашего кода ROS 2. Если вы хотите, чтобы ваш код можно было установить или поделиться им с другими, то вам нужно организовать его в виде пакета. С помощью пакетов вы можете выпустить свою работу над ROS 2 и позволить другим легко собирать и использовать ее.

Для создания пакетов в ROS 2 используется система сборки ament, а в качестве инструмента сборки - colcon. Вы можете создать пакет, используя CMake или Python, которые официально поддерживаются, хотя существуют и другие типы сборки.

### 2. Что входит в состав пакета ROS 2?

Пакеты ROS 2 Python и CMake имеют свой минимально необходимый состав:

- `CMakeLists.txt` файл, описывающий, как собрать код в пакете
- `include/<package_name>` каталог, содержащий публичные заголовки для пакета
- `package.xml` файл, содержащий метаинформацию о пакете
- `src` каталог, содержащий исходный код пакета

Простейший пакет может иметь файловую структуру, которая выглядит следующим образом:

```bash
my_package/
     CMakeLists.txt
     include/my_package/
     package.xml
     src/
```

### 3. Пакеты в рабочем пространстве

Одно рабочее пространство может содержать столько пакетов, сколько вы хотите, каждый в своей папке. Также в одном рабочем пространстве могут находиться пакеты разных типов сборки (CMake, Python и т. д.). Нельзя иметь вложенные пакеты.

Лучше всего иметь папку src в рабочей области и создавать пакеты в ней. Это позволяет сохранить верхний уровень рабочего пространства «чистым».

Тривиальное рабочее пространство может выглядеть следующим образом:

```bash
workspace_folder/
    src/
      cpp_package_1/
          CMakeLists.txt
          include/cpp_package_1/
          package.xml
          src/

      py_package_1/
          package.xml
          resource/py_package_1
          setup.cfg
          setup.py
          py_package_1/
      ...
      cpp_package_n/
          CMakeLists.txt
          include/cpp_package_n/
          package.xml
          src/
```

## Задания

### 1. Создайте пакет

Давайте используем рабочую область, созданную в предыдущем уроке, `ros2_ws`, для вашего нового пакета.

Перед выполнением команды создания пакета убедитесь, что вы находитесь в папке `src`.

```bash
cd ~/ros2_ws/src
```

Синтаксис команды для создания нового пакета в ROS 2 следующий:

```bash
ros2 pkg create --build-type ament_cmake --license Apache-2.0 <package_name>
```

В этом уроке вы будете использовать необязательный аргумент `--node-name`, который создаст простой исполняемый файл типа Hello World в пакете.

Введите в терминале следующую команду:

```bash
ros2 pkg create --build-type ament_cmake --license Apache-2.0 --node-name my_node my_package
```
Теперь в каталоге `src` вашего рабочего пространства появится новая папка под названием `my_package`.

После выполнения команды ваш терминал выдаст сообщение:

```bash
going to create a new package
package name: my_package
destination directory: /home/user/ros2_ws/src
package format: 3
version: 0.0.0
description: TODO: Package description
maintainer: ['<name> <email>']
licenses: ['TODO: License declaration']
build type: ament_cmake
dependencies: []
node_name: my_node
creating folder ./my_package
creating ./my_package/package.xml
creating source and include folder
creating folder ./my_package/src
creating folder ./my_package/include/my_package
creating ./my_package/CMakeLists.txt
creating ./my_package/src/my_node.cpp
```

![006](images/006.png)

Вы можете увидеть автоматически сгенерированные файлы для нового пакета.

### 2. Сборка пакета

Размещение пакетов в рабочем пространстве особенно ценно тем, что вы можете собирать много пакетов одновременно, выполнив команду `colcon build` в корне рабочего пространства. В противном случае вам пришлось бы собирать каждый пакет по отдельности.

Вернитесь в корень рабочей области:

```bash
cd ~/ros2_ws
```

Теперь вы можете собирать свои пакеты:

```bash
colcon build
```

Вспомните из предыдущего урока, что в вашей папке `ros2_ws` также есть пакет `ros_tutorials`. Вы могли заметить, что запуск `colcon build` также собрал пакет `turtlesim`. Это хорошо, когда в вашем рабочем пространстве всего несколько пакетов, но когда пакетов много, `colcon build` может занять много времени.

Чтобы в следующий раз собрать только пакет `my_package`, вы можете выполнить команду:

```bash
colcon build --packages-select my_package
```

![007](images/007.png)

### 3. Источник установочного файла

Чтобы использовать новый пакет и исполняемый файл, сначала откройте новый терминал и создайте исходный код вашей основной установки ROS 2.

Затем, находясь в директории `ros2_ws`, выполните следующую команду, чтобы создать исходное рабочее пространство:

```bash
source install/local_setup.bash
```

Теперь, когда рабочее пространство добавлено в путь, вы сможете использовать исполняемые файлы нового пакета.

### 4. Использование пакета

Чтобы запустить исполняемый файл, который вы создали с помощью аргумента `--node-name` при создании пакета, введите команду:

```bash
ros2 run my_package my_node
```

Это приведет к появлению сообщения на вашем терминале:

```bash
hello world my_package package
```
![008](images/008.png)

### 5. Изучите содержимое пакета

Внутри `ros2_ws/src/my_package` вы увидите файлы и папки, которые `ros2 pkg create` автоматически сгенерировал:

```bash
CMakeLists.txt  include  package.xml  src
```

### 6. Настройте файл package.xml

Возможно, вы заметили в ответном сообщении после создания пакета, что поля `description` и `license` содержат пометки `TODO`. Это потому, что описание пакета и декларация лицензии не устанавливаются автоматически, но необходимы, если вы хотите выпустить свой пакет. Поле `maintainer` также может потребоваться заполнить.

Из папки `ros2_ws/src/my_package` откройте файл `package.xml` с помощью удобного текстового редактора:

```bash
<?xml version="1.0"?>
<?xml-model
   href="http://download.ros.org/schema/package_format3.xsd"
   schematypens="http://www.w3.org/2001/XMLSchema"?>
<package format="3">
 <name>my_package</name>
 <version>0.0.0</version>
 <description>TODO: Package description</description>
 <maintainer email="user@todo.todo">user</maintainer>
 <license>TODO: License declaration</license>

 <buildtool_depend>ament_cmake</buildtool_depend>

 <test_depend>ament_lint_auto</test_depend>
 <test_depend>ament_lint_common</test_depend>

 <export>
   <build_type>ament_cmake</build_type>
 </export>
</package>
```

Введите своё имя и электронную почту в строку сопровождающего, если она не была заполнена автоматически. Затем отредактируйте строку описания, чтобы кратко описать пакет:

```bash
<description>Beginner client libraries tutorials practice package</description>
```

Затем обновите строку лицензии. Подробнее о лицензиях с открытым исходным кодом вы можете прочитать здесь. Поскольку этот пакет предназначен только для практики, можно использовать любую лицензию. Мы будем использовать Apache License 2.0:

```bash
<license>Apache License 2.0</license>
```

Не забудьте сохранить, когда закончите редактирование.

![009](images/009.png)

Ниже тега лицензии вы увидите несколько имен тегов, заканчивающихся на _depend. Это место, где ваш package.xml будет перечислять свои зависимости от других пакетов, чтобы colcon мог их искать. my_package прост и не имеет никаких зависимостей, но вы увидите, как это место будет использовано в последующих уроках.

## Резюме

Вы создали пакет, чтобы упорядочить свой код и сделать его удобным для использования другими.

Ваш пакет был автоматически заполнен необходимыми файлами, а затем вы использовали colcon для его сборки, чтобы вы могли использовать его исполняемые файлы в своем локальном окружении.
